<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AppColetor.ViewModels"
             x:Class="AppColetor.Views.Pages.TestesPage"
             x:DataType="vm:TestesViewModel"
             Title="ðŸ§ª Testes e DiagnÃ³sticos">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- CabeÃ§alho -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="ðŸ”¬ TESTES DE STRESS"
                           Style="{StaticResource LabelTitulo}" />
                    <Label Text="Execute testes para validar o funcionamento do coletor"
                           Style="{StaticResource LabelMuted}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Progresso -->
            <Frame Style="{StaticResource CardFrame}"
                   IsVisible="{Binding IsTestando}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="{Binding TesteMensagem}" FontAttributes="Bold" />
                    <ProgressBar Progress="{Binding TesteProgresso}" 
                                 ProgressColor="{StaticResource Primary}" />
                    <Label Text="{Binding TesteDetalhe}" Style="{StaticResource LabelMuted}" />
                    <Button Text="âŒ Cancelar"
                            Command="{Binding CancelarTesteCommand}"
                            Style="{StaticResource ButtonDanger}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Teste de Leituras RÃ¡pidas -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="âš¡ Teste de Leituras RÃ¡pidas" FontAttributes="Bold" />
                    <Label Text="Simula mÃºltiplas leituras em sequÃªncia rÃ¡pida"
                           Style="{StaticResource LabelMuted}" />

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" 
                          ColumnSpacing="12" RowSpacing="8">
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="Total de Leituras" FontSize="12" />
                            <Entry Text="{Binding TotalLeiturasRapidas}" 
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="Intervalo (ms)" FontSize="12" />
                            <Entry Text="{Binding IntervaloLeiturasMs}" 
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>
                    </Grid>

                    <Button Text="â–¶ï¸ Executar Teste"
                            Command="{Binding ExecutarTesteLeiturasCommand}"
                            IsEnabled="{Binding PodeExecutar}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Teste de Burst -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ’¥ Teste de Rajada (Burst)" FontAttributes="Bold" />
                    <Label Text="Simula largada com muitas motos passando juntas"
                           Style="{StaticResource LabelMuted}" />

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" 
                          ColumnSpacing="12" RowSpacing="8">
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="Leituras por Rajada" FontSize="12" />
                            <Entry Text="{Binding LeiturasPorBurst}" 
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="NÃºmero de Rajadas" FontSize="12" />
                            <Entry Text="{Binding NumeroBursts}" 
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>
                    </Grid>

                    <Button Text="â–¶ï¸ Executar Teste"
                            Command="{Binding ExecutarTesteBurstCommand}"
                            IsEnabled="{Binding PodeExecutar}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Teste de MemÃ³ria -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ§  Teste de MemÃ³ria" FontAttributes="Bold" />
                    <Label Text="Verifica vazamentos de memÃ³ria apÃ³s mÃºltiplos ciclos"
                           Style="{StaticResource LabelMuted}" />

                    <Button Text="â–¶ï¸ Executar Teste"
                            Command="{Binding ExecutarTesteMemoriaCommand}"
                            IsEnabled="{Binding PodeExecutar}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Teste de ReconexÃ£o -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ”„ Teste de ReconexÃ£o" FontAttributes="Bold" />
                    <Label Text="Simula quedas de conexÃ£o e reconexÃ£o automÃ¡tica"
                           Style="{StaticResource LabelMuted}" />

                    <Button Text="â–¶ï¸ Executar Teste"
                            Command="{Binding ExecutarTesteReconexaoCommand}"
                            IsEnabled="{Binding PodeExecutar}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Teste de Sync Offline -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ“¶ Teste de SincronizaÃ§Ã£o Offline" FontAttributes="Bold" />
                    <Label Text="Testa armazenamento local e sincronizaÃ§Ã£o posterior"
                           Style="{StaticResource LabelMuted}" />

                    <Button Text="â–¶ï¸ Executar Teste"
                            Command="{Binding ExecutarTesteSyncOfflineCommand}"
                            IsEnabled="{Binding PodeExecutar}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Resultado do Teste -->
            <Frame Style="{StaticResource CardFrame}"
                   BackgroundColor="{Binding ResultadoCor}"
                   IsVisible="{Binding TemResultado}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="ðŸ“Š RESULTADO" FontAttributes="Bold" />
                    <Label Text="{Binding ResultadoTexto}"
                           FontFamily="Consolas" 
                           FontSize="12" />
                </VerticalStackLayout>
            </Frame>

            <!-- DiagnÃ³sticos -->
            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ” DIAGNÃ“STICOS" Style="{StaticResource LabelSubtitulo}" />

                    <Button Text="ðŸ“‹ Gerar RelatÃ³rio Completo"
                            Command="{Binding GerarRelatorioCommand}" />

                    <Button Text="ðŸ—‘ï¸ Limpar Dados de Teste"
                            Command="{Binding LimparDadosTesteCommand}"
                            Style="{StaticResource ButtonOutline}" />

                    <Button Text="ðŸ“¤ Exportar Logs"
                            Command="{Binding ExportarLogsCommand}"
                            Style="{StaticResource ButtonOutline}" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>